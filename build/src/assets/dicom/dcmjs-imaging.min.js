/*! dcmjs-imaging - 0.1.25 - 2024-08-07 | (c) 2021-2024 Pantelis Georgiadis | https://github.com/PantelisGeorgiadis/dcmjs-imaging */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("dcmjs")):"function"==typeof define&&define.amd?define("dcmjs-imaging",["dcmjs"],t):"object"==typeof exports?exports["dcmjs-imaging"]=t(require("dcmjs")):e.dcmjsImaging=t(e.dcmjs)}(this,(__WEBPACK_EXTERNAL_MODULE__111__=>(()=>{var __webpack_modules__={935:function(e,t,i){var r,s;r=function(e){"use strict";var t,i,r=function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(t in arguments[i])Object.prototype.hasOwnProperty.call(arguments[i],t)&&(e[t]=arguments[i][t]);return e},s={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},n={},a=function(e,i){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var a=e.methodFactory,o=e.name||"",l=n[o]||n[""]||s;function h(e,t,i){var r=a(e,t,i),s=n[i]||n[""],l=-1!==s.template.indexOf("%t"),h=-1!==s.template.indexOf("%l"),u=-1!==s.template.indexOf("%n");return function(){for(var t="",a=arguments.length,c=Array(a),g=0;g<a;g++)c[g]=arguments[g];if(o||!n[i]){var d=s.timestampFormatter(new Date),p=s.levelFormatter(e),m=s.nameFormatter(i);s.format?t+=s.format(p,m,d):(t+=s.template,l&&(t=t.replace(/%t/,d)),h&&(t=t.replace(/%l/,p)),u&&(t=t.replace(/%n/,m))),c.length&&"string"==typeof c[0]?c[0]=t+" "+c[0]:c.unshift(t)}r.apply(void 0,c)}}return n[o]||(e.methodFactory=h),(i=i||{}).template&&(i.format=void 0),n[o]=r({},l,i),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e},o={reg:function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},apply:a};return e&&(i=e.prefix,o.noConflict=function(){return e.prefix===o&&(e.prefix=i),o}),o},void 0===(s="function"==typeof r?r.call(t,i,t,e):r)||(e.exports=s)},213:function(e,t,i){var r,s;!function(n,a){"use strict";r=function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},n=null;function a(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&i?o:void 0!==console[r]?a(console,r):void 0!==console.log?a(console,"log"):e)}function h(){for(var i=this.getLevel(),s=0;s<r.length;s++){var n=r[s];this[n]=s<i?e:this.methodFactory(n,i,this.name)}if(this.log=this.debug,typeof console===t&&i<this.levels.SILENT)return"No console available for logging"}function u(e){return function(){typeof console!==t&&(h.call(this),this[e].apply(this,arguments))}}function c(e,t,i){return l(e)||u.apply(this,arguments)}function g(e,i){var a,o,l,u=this,g="loglevel";function d(e){var i=(r[e]||"silent").toUpperCase();if(typeof window!==t&&g){try{return void(window.localStorage[g]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(g)+"="+i+";"}catch(e){}}}function p(){var e;if(typeof window!==t&&g){try{e=window.localStorage[g]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,r=encodeURIComponent(g),s=i.indexOf(r+"=");-1!==s&&(e=/^([^;]+)/.exec(i.slice(s+r.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function m(){if(typeof window!==t&&g){try{window.localStorage.removeItem(g)}catch(e){}try{window.document.cookie=encodeURIComponent(g)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}function f(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?g+=":"+e:"symbol"==typeof e&&(g=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=i||c,u.getLevel=function(){return null!=l?l:null!=o?o:a},u.setLevel=function(e,t){return l=f(e),!1!==t&&d(l),h.call(u)},u.setDefaultLevel=function(e){o=f(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,m(),h.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(n!==u&&(a=f(n.getLevel())),h.call(u),n===u)for(var e in s)s[e].rebuild()},a=f(n?n.getLevel():"WARN");var w=p();null!=w&&(l=f(w)),h.call(u)}(n=new g).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=s[e];return t||(t=s[e]=new g(e,n.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return n.noConflict=function(){return typeof window!==t&&window.log===n&&(window.log=d),n},n.getLoggers=function(){return s},n.default=n,n},void 0===(s="function"==typeof r?r.call(t,i,t,e):r)||(e.exports=s)}()},923:(e,t,i)=>{const{LutPipeline:r}=i(68),{PixelPipeline:s}=i(605);class n{constructor(e){this.max=e,this.cache=new Map}get(e){const t=this.cache.get(e);return t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.max&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}}e.exports={LutPipelineCache:class extends n{constructor(e){super(e)}getOrCreate(e,t,i,s){if(!t)return r.create(e,t,i,s);const n=this._createCacheKey(t,i),a=this.get(n);if(void 0!==a)return a;const o=r.create(e,t,i,s);return this.set(n,o),o}_createCacheKey(e,t){return`${t}_${e.getWindow()}_${e.getLevel()}`}},PixelPipelineCache:class extends n{constructor(e){super(e)}getOrCreate(e,t){const i=this.get(t);if(void 0!==i)return i;const r=s.create(e,t);return this.set(t,r),r}}}},91:(e,t,i)=>{const{StandardColorPalette:r}=i(492),s=[{palette:r.HotIron,r:[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255],b:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255]},{palette:r.Pet,r:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,63,61,59,57,55,53,51,49,47,45,43,41,39,37,35,33,31,29,27,25,23,21,19,17,15,13,11,9,7,5,3,1,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255],b:[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,252,248,244,240,236,232,228,224,220,216,212,208,204,200,196,192,188,184,180,176,172,168,164,160,156,152,148,144,140,136,132,128,124,120,116,112,108,104,100,96,92,88,84,80,76,72,68,64,60,56,52,48,44,40,36,32,28,24,20,16,12,8,4,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,85,89,93,97,101,105,109,113,117,121,125,129,133,137,141,145,149,153,157,161,165,170,174,178,182,186,190,194,198,202,206,210,214,218,222,226,230,234,238,242,246,250,255]},{palette:r.HotMetalBlue,r:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,26,29,32,35,38,41,44,47,50,52,55,57,59,62,64,66,69,71,74,76,78,81,83,85,88,90,93,96,99,102,105,108,111,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,166,169,172,175,178,181,184,187,190,194,198,201,205,209,213,217,221,224,228,232,236,240,244,247,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,9,11,13,15,17,19,21,23,24,26,28,30,32,34,36,38,40,41,43,45,47,49,51,53,55,56,58,60,62,64,66,68,70,72,73,75,77,79,81,83,85,87,88,90,92,94,96,98,100,102,104,105,107,109,111,113,115,117,119,120,122,124,126,128,130,132,134,136,137,139,141,143,145,147,149,151,152,154,156,158,160,162,164,166,168,169,171,173,175,177,179,181,183,184,186,188,190,192,194,196,198,200,201,203,205,207,209,211,213,215,216,218,220,222,224,226,228,229,231,233,235,237,239,240,242,244,246,248,250,251,253,255],b:[0,2,4,6,8,10,12,14,16,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,184,186,188,190,192,194,196,198,200,197,194,191,188,185,182,179,176,174,171,168,165,162,159,156,153,150,144,138,132,126,121,115,109,103,97,91,85,79,74,68,62,56,50,47,44,41,38,35,32,29,26,24,21,18,15,12,9,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,26,29,32,35,38,41,44,47,50,53,56,59,62,65,68,71,74,76,79,82,85,88,91,94,97,100,103,106,109,112,115,118,121,124,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,176,179,182,185,188,191,194,197,200,203,206,210,213,216,219,223,226,229,232,236,239,242,245,249,252,255]},{palette:r.Pet20Step,r:[0,0,0,0,0,0,0,0,0,0,0,0,0,96,96,96,96,96,96,96,96,96,96,96,96,96,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,80,80,80,80,80,80,80,80,80,80,80,80,80,96,96,96,96,96,96,96,96,96,96,96,96,96,112,112,112,112,112,112,112,112,112,112,112,112,112,128,128,128,128,128,128,128,128,128,128,128,128,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,80,80,80,80,80,80,80,80,80,80,80,80,80,64,64,64,64,64,64,64,64,64,64,64,64,224,224,224,224,224,224,224,224,224,224,224,224,224,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,192,192,192,192,192,192,192,192,192,192,192,192,192,176,176,176,176,176,176,176,176,176,176,176,176,176,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,80,80,80,80,80,80,80,80,80,80,80,80,80,96,96,96,96,96,96,96,96,96,96,96,96,96,112,112,112,112,112,112,112,112,112,112,112,112,112,128,128,128,128,128,128,128,128,128,128,128,128,96,96,96,96,96,96,96,96,96,96,96,96,96,144,144,144,144,144,144,144,144,144,144,144,144,144,192,192,192,192,192,192,192,192,192,192,192,192,192,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,208,208,208,208,208,208,208,208,208,208,208,208,208,176,176,176,176,176,176,176,176,176,176,176,176,176,144,144,144,144,144,144,144,144,144,144,144,144,96,96,96,96,96,96,96,96,96,96,96,96,96,48,48,48,48,48,48,48,48,48,48,48,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255],b:[0,0,0,0,0,0,0,0,0,0,0,0,0,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,112,112,112,112,112,112,112,112,112,112,112,112,128,128,128,128,128,128,128,128,128,128,128,128,128,176,176,176,176,176,176,176,176,176,176,176,176,176,192,192,192,192,192,192,192,192,192,192,192,192,192,224,224,224,224,224,224,224,224,224,224,224,224,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,80,80,80,80,80,80,80,80,80,80,80,80,80,64,64,64,64,64,64,64,64,64,64,64,64,80,80,80,80,80,80,80,80,80,80,80,80,80,96,96,96,96,96,96,96,96,96,96,96,96,96,64,64,64,64,64,64,64,64,64,64,64,64,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255]}];Object.freeze(s);e.exports=class{static getColorPaletteMonochrome1(){return this._getGrayscaleColorPalette(!0)}static getColorPaletteMonochrome2(){return this._getGrayscaleColorPalette(!1)}static getColorPalettePaletteColor(e){let t=0,i=0;const r=e.getRedPaletteColorLookupTableDescriptor();void 0!==r&&Array.isArray(r)&&r.length>1&&(t=r[0],i=r[2]),t=0===t?65536:t,i=0===i?16:i;const s=e.getRedPaletteColorLookupTableData(),n=e.getGreenPaletteColorLookupTableData(),a=e.getBluePaletteColorLookupTableData();if(void 0===s||void 0===n||void 0===a)throw new Error("Palette color LUT data is missing");const o=new Uint8Array(Array.isArray(s)?s.find((e=>e)):s),l=new Uint8Array(Array.isArray(n)?n.find((e=>e)):n),h=new Uint8Array(Array.isArray(a)?a.find((e=>e)):a),u=new Array(t);if(o.length===t)for(let e=0;e<t;e++)u[e]=255<<24|o[e]<<16|l[e]<<8|h[e];else{let e=16===i?1:0;for(let i=0;i<t;i++,e+=2)u[i]=255<<24|o[e]<<16|l[e]<<8|h[e]}return u}static getColorPaletteStandard(e){const t=s.find((t=>t.palette===e));if(!t)throw new Error(`Standard color palette not found [${e}]`);const i=new Array(256);for(let e=0;e<256;e++)i[e]=255<<24|t.r[e]<<16|t.g[e]<<8|t.b[e];return i}static _getGrayscaleColorPalette(e){const t=new Array(256);for(let i=0,r=e?255:0;i<256;i++,e?r--:r++)t[i]=255<<24|r<<16|r<<8|r;return t}}},492:e=>{const t={ImplicitVRLittleEndian:"1.2.840.10008.1.2",ExplicitVRLittleEndian:"1.2.840.10008.1.2.1",DeflatedExplicitVRLittleEndian:"1.2.840.10008.1.2.1.99",ExplicitVRBigEndian:"1.2.840.10008.1.2.2",RleLossless:"1.2.840.10008.1.2.5",JpegBaselineProcess1:"1.2.840.10008.1.2.4.50",JpegBaselineProcess2_4:"1.2.840.10008.1.2.4.51",JpegLosslessProcess14:"1.2.840.10008.1.2.4.57",JpegLosslessProcess14V1:"1.2.840.10008.1.2.4.70",JpegLsLossless:"1.2.840.10008.1.2.4.80",JpegLsLossy:"1.2.840.10008.1.2.4.81",Jpeg2000Lossless:"1.2.840.10008.1.2.4.90",Jpeg2000Lossy:"1.2.840.10008.1.2.4.91",HtJpeg2000Lossless:"1.2.840.10008.1.2.4.201",HtJpeg2000LosslessRpcl:"1.2.840.10008.1.2.4.202",HtJpeg2000Lossy:"1.2.840.10008.1.2.4.203"};Object.freeze(t);const i=[t.ImplicitVRLittleEndian,t.ExplicitVRLittleEndian,t.DeflatedExplicitVRLittleEndian,t.ExplicitVRBigEndian,t.RleLossless,t.JpegBaselineProcess1,t.JpegBaselineProcess2_4,t.JpegLosslessProcess14,t.JpegLosslessProcess14V1,t.JpegLsLossless,t.JpegLsLossy,t.Jpeg2000Lossless,t.Jpeg2000Lossy,t.HtJpeg2000Lossless,t.HtJpeg2000LosslessRpcl,t.HtJpeg2000Lossy];Object.freeze(i);const r={Monochrome1:"MONOCHROME1",Monochrome2:"MONOCHROME2",PaletteColor:"PALETTE COLOR",Rgb:"RGB",YbrFull:"YBR_FULL",YbrFull422:"YBR_FULL_422",YbrPartial422:"YBR_PARTIAL_422",YbrPartial420:"YBR_PARTIAL_420",YbrIct:"YBR_ICT",YbrRct:"YBR_RCT",Cmyk:"CMYK",Argb:"ARGB",Hsv:"HSV"};Object.freeze(r);const s={Interleaved:0,Planar:1};Object.freeze(s);const n={Unsigned:0,Signed:1};Object.freeze(n);const a={Grayscale:0,HotIron:1,Pet:2,HotMetalBlue:3,Pet20Step:4};Object.freeze(a);const o=-65281;Object.freeze(o),e.exports={OverlayColor:o,PhotometricInterpretation:r,PixelRepresentation:n,PlanarConfiguration:s,RenderableTransferSyntaxes:i,StandardColorPalette:a,TransferSyntax:t}},408:(e,t,i)=>{const{OverlayColor:r,PhotometricInterpretation:s,RenderableTransferSyntaxes:n,StandardColorPalette:a,TransferSyntax:o}=i(492),{LutPipelineCache:l,PixelPipelineCache:h}=i(923),{GrayscaleLutPipeline:u,LutPipeline:c,PaletteColorLutPipeline:g,RgbColorLutPipeline:d}=i(68),{Pixel:p,PixelPipeline:m}=i(605),{G60xxOverlay:f,Overlay:w}=i(153),x=i(311),P=i(547),y=i(111),{DicomMessage:b,DicomMetaDictionary:v,ReadBufferStream:E,Tag:S,WriteBufferStream:L}=y.data,_=y.log;e.exports=class{constructor(e,t,i){if(i=i||{},_.level="error",this.pixelPipelineCache=new h(i.pixelPipelineCacheSize||1),this.lutPipelineCache=new l(i.lutPipelineCacheSize||1),this.transferSyntaxUid=t||o.ImplicitVRLittleEndian,e instanceof ArrayBuffer)if(t)this.elements=this._fromElementsBuffer(e,t);else{const t=this._fromP10Buffer(e);this.elements=t.elements,this.transferSyntaxUid=t.transferSyntaxUid}else this.elements=e||{}}getElement(e){return this.elements[e]}setElement(e,t){this.elements[e]=t}getElements(){return this.elements}getTransferSyntaxUid(){return this.transferSyntaxUid}setTransferSyntaxUid(e){this.transferSyntaxUid=e}getDenaturalizedDataset(e,t){const i=t?v.denaturalizeDataset(this.getElements(),{...v.nameMap,...t}):v.denaturalizeDataset(this.getElements()),r=new L;return b.write(i,r,this.transferSyntaxUid,e),r.getBuffer()}getWidth(){return this.getElement("Columns")}getHeight(){return this.getElement("Rows")}getNumberOfFrames(){return this.getElement("NumberOfFrames")||1}render(e){return e=e||{},this._render(e)}renderIcon(){return this._renderIcon()}toString(){const e=[];return e.push("DICOM image:"),e.push("=".repeat(50)),e.push(JSON.stringify(this.getElements())),e.join("\n")}_fromP10Buffer(e){const t=b.readFile(this._checkAndPatchP10PreamblePrefixAndMeta(e),{ignoreErrors:!0}),i=v.naturalizeDataset(t.meta).TransferSyntaxUID;return{elements:v.naturalizeDataset(t.dict),transferSyntaxUid:i}}_checkAndPatchP10PreamblePrefixAndMeta(e){if(e.byteLength<132)throw new Error(`Invalid DICOM file - buffer length is less than 132 bytes [length: ${e.byteLength}]`);const t=new E(e,!0,{noCopy:!0});if(t.reset(),t.increment(128),"DICM"===t.readAsciiString(4))return e;let i=!1;t.reset();let r=t.readUint16();if(r>255&&(r=(255&r)<<8|r>>8&255,t.setEndian(!1),i=!0),r>255)throw new Error(`Invalid DICOM file - read invalid group [group: ${r}]`);const s=[];s.push(new ArrayBuffer(128));const n=Uint8Array.from(["D".charCodeAt(0),"I".charCodeAt(0),"C".charCodeAt(0),"M".charCodeAt(0)]);if(s.push(n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)),r>2){const e=t.readUint16(),n=S.fromNumbers(r,e),a=b.lookupTag(n);if(0!==e&&!a)throw new Error(`Invalid DICOM file - could not find tag in the dictionary [tag: ${n.toString()}]`);const l=t.readVR(),h=l.charCodeAt(0),u=l.charCodeAt(1),c=!(h>=65&&h<=90&&u>=65&&u<=90);if(i&&c)throw new Error("Invalid DICOM file - implicit VR big endian syntax found");const g=i?o.ExplicitVRBigEndian:c?o.ImplicitVRLittleEndian:o.ExplicitVRLittleEndian,d=new L;b.write(v.denaturalizeDataset({TransferSyntaxUID:g}),d,o.ExplicitVRLittleEndian,{});const p=new L;b.writeTagObject(p,"00020000","UL",d.size,o.ExplicitVRLittleEndian,{}),p.concat(d),s.push(p.getBuffer()),P.warn(`DICOM meta file information was not found and was added containing transfer syntax UID ${g}`)}return s.push(e),s.reduce(((e,t,i)=>{if(0===i)return e;const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}),s[0])}_fromElementsBuffer(e,t){const i=new E(e),r=t===o.ImplicitVRLittleEndian?o.ImplicitVRLittleEndian:t===o.ExplicitVRBigEndian?o.ExplicitVRBigEndian:o.ExplicitVRLittleEndian,s=b._read(i,r,{ignoreErrors:!0});return v.naturalizeDataset(s)}_render(e){if(!n.includes(this.getTransferSyntaxUid()))throw new Error(`Transfer syntax cannot be currently rendered [${this.getTransferSyntaxUid()}]`);const t=e.frame||0;if(t<0||t>=this.getNumberOfFrames())throw new Error(`Requested frame is out of range [${t}]`);if(e.windowLevel&&!(e.windowLevel instanceof x))throw new Error(`${e.windowLevel.toString()} is not a WindowLevel`);let i,s,o=e.colorPalette,l={},h=e.windowLevel;if(void 0===h){const e=x.fromDicomImageElements(this.getElements());e.length>0&&(h=e[0])}const c=new p(this.getElements(),this.getTransferSyntaxUid()),m=this.lutPipelineCache.getOrCreate(c,h,t,o),P=m.getLut();P&&!P.isValid()&&P.recalculate(),m instanceof u&&(s=m.getWindowLevel(),void 0===o&&(o=a.Grayscale)),(m instanceof d||m instanceof g)&&(o=void 0);const y=this.pixelPipelineCache.getOrCreate(c,t);let b=y.render(P);void 0!==e.calculateHistograms&&e.calculateHistograms&&(i=y.calculateHistograms());if(void 0===e.renderOverlays||e.renderOverlays){const e=w.fromDicomImageElements(this.getElements());for(let i=0;i<e.length;i++){const s=e[i];s instanceof f&&(t+1<s.getFrameOrigin()||t+1>s.getFrameOrigin()+s.getNumberOfFrames()-1)||s.render(b,c.getWidth(),c.getHeight(),r)}}const v=new Uint8Array(4*c.getWidth()*c.getHeight());for(let e=0,t=0;e<c.getWidth()*c.getHeight();e++){const i=b[e];v[t++]=i>>16&255,v[t++]=i>>8&255,v[t++]=255&i,v[t++]=255}return l.frame=t,l.width=c.getWidth(),l.height=c.getHeight(),l.pixels=v.buffer,s&&(l.windowLevel=s),i&&(l.histograms=i),void 0!==o&&(l.colorPalette=o),l}_renderIcon(){const e=this.getElement("IconImageSequence");if(void 0===e||!Array.isArray(e)||0===e.length)throw new Error("Image does not contain IconImageSequence");const t=e.find((e=>e)),i=t.PhotometricInterpretation;if(i!==s.PaletteColor&&i!==s.Monochrome1&&i!==s.Monochrome2)throw new Error(`Photometric interpretation for IconImageSequence must be MONOCHROME 1, MONOCHROME 2 or PALETTE COLOR [photometric interpretation: ${i}]`);let r,l,h=this.getTransferSyntaxUid();if(h!==o.ImplicitVRLittleEndian&&h!==o.ExplicitVRLittleEndian&&h!==o.DeflatedExplicitVRLittleEndian&&h!==o.ExplicitVRBigEndian){const e=new p(t,h),i=e.getPixelData();let r=new Uint8Array(Array.isArray(i)?i.find((e=>e)):i);const s=e.getUncompressedFrameSize();r.length===s&&(h=o.ExplicitVRLittleEndian)}if(!n.includes(h))throw new Error(`Transfer syntax cannot be currently rendered [${h}]`);let g={};const d=new p(t,h),f=c.create(d,void 0,0,void 0),w=f.getLut();w&&!w.isValid()&&w.recalculate(),f instanceof u&&(r=f.getWindowLevel(),l=a.Grayscale);let x=m.create(d,0).render(w);const P=new Uint8Array(4*d.getWidth()*d.getHeight());for(let e=0,t=0;e<d.getWidth()*d.getHeight();e++){const i=x[e];P[t++]=i>>16&255,P[t++]=i>>8&255,P[t++]=255&i,P[t++]=255}return g.frame=0,g.width=d.getWidth(),g.height=d.getHeight(),g.pixels=P.buffer,r&&(g.windowLevel=r),void 0!==l&&(g.colorPalette=l),g}}},675:e=>{e.exports=class{constructor(e,t,i){this.identifier=e,this.min=t,this.max=i,this.offset=-t;const r=i-t+1;this.values=new Array(r);for(let e=0;e<r;++e)this.values[e]=0}getIdentifier(){return this.identifier}getMinimum(){return this.min}getMaximum(){return this.max}add(e){const t=e+this.offset;t<0||t>=this.values.length||this.values[t]++}clear(e){const t=e+this.offset;t<0||t>=this.values.length||(this.values[t]=0)}get(e){const t=e+this.offset;if(!(t<0||t>=this.values.length))return this.values[t]}toString(){return`Histogram Identifier: ${this.getIdentifier()}, Minimum: ${this.getMinimum()}, Maximum: ${this.getMaximum()}`}}},68:(e,t,i)=>{const{PhotometricInterpretation:r,StandardColorPalette:s}=i(492),n=i(91),a=i(311);class o{isValid(){throw new Error("isValid should be implemented")}getMinimumOutputValue(){throw new Error("getMinimumOutputValue should be implemented")}getMaximumOutputValue(){throw new Error("getMaximumOutputValue should be implemented")}recalculate(){throw new Error("recalculate should be implemented")}getValue(e){throw new Error("getValue should be implemented")}}class l extends o{constructor(e,t,i,r){super(),this.slope=i,this.intercept=r,this.minValue=this.getValue(e),this.maxValue=this.getValue(t)}getRescaleSlope(){return this.slope}getRescaleIntercept(){return this.intercept}isValid(){return!0}getMinimumOutputValue(){return this.minValue}getMaximumOutputValue(){return this.maxValue}recalculate(){}getValue(e){return Math.trunc(e*this.getRescaleSlope()+this.getRescaleIntercept())}}class h extends o{constructor(e,t){super(),this.setWindowLevel(e),this.setFunction(t||"LINEAR"),this.valid=!1}getWindowLevel(){return this.windowLevel}setWindowLevel(e){this.windowLevel=e,this.valid=!1}getFunction(){return this.function}setFunction(e){this.function=e,this.valid=!1}isValid(){return this.valid}getMinimumOutputValue(){return 0}getMaximumOutputValue(){return 255}recalculate(){if(this.isValid())return;const e=this.getWindowLevel();this.windowCenter=e.getLevel(),this.windowWidth=e.getWindow(),this.windowCenterMin05=this.windowCenter-.5,this.windowWidthMin1=this.windowWidth-1,this.windowWidthDiv2=this.windowWidthMin1/2,this.windowStart=Math.trunc(this.windowCenterMin05-this.windowWidthDiv2),this.windowEnd=Math.trunc(this.windowCenterMin05+this.windowWidthDiv2),this.valid=!0}getValue(e){return 1===this.windowWidth?e<this.windowCenterMin05?this.getMinimumOutputValue():this.getMaximumOutputValue():"SIGMOID"===this.function.toUpperCase()?Math.min(this.getMaximumOutputValue(),Math.max(this.getMinimumOutputValue(),Math.trunc(this.getMaximumOutputValue()/(1+Math.exp((e-this.windowCenter)/this.windowWidth*-4))))):"LINEAR_EXACT"===this.function.toUpperCase()?Math.min(this.getMaximumOutputValue(),Math.max(this.getMinimumOutputValue(),Math.trunc((e-this.windowCenter)/this.windowWidth*this.getMaximumOutputValue()+this.getMinimumOutputValue()))):Math.min(this.getMaximumOutputValue(),Math.max(this.getMinimumOutputValue(),Math.trunc(((e-this.windowCenterMin05)/this.windowWidthMin1+.5)*this.getMaximumOutputValue()+this.getMinimumOutputValue())))}}class u extends o{constructor(e,t){super(),this.minValue=e,this.maxValue=t}isValid(){return!0}getMinimumOutputValue(){return this.minValue}getMaximumOutputValue(){return this.maxValue}recalculate(){}getValue(e){return Math.trunc(this.getMaximumOutputValue()-e)}}class c extends o{constructor(e,t){super(),this.minValue=e,this.setColorPalette(t)}getColorPalette(){return this.colorPalette}setColorPalette(e){this.colorPalette=e}isValid(){return void 0!==this.colorPalette}getMinimumOutputValue(){return Number.MIN_SAFE_INTEGER}getMaximumOutputValue(){return Number.MAX_SAFE_INTEGER}recalculate(){}getValue(e){return Math.trunc(this.colorPalette[e-this.minValue>0?e-this.minValue:0])}}class g extends o{constructor(e){super(),this.table=void 0,this.setColorPalette(e)}getColorPalette(){return this.colorPalette}setColorPalette(e){if(void 0===e||!Array.isArray(e)||256!==e.length)throw new Error("Expected 256-entry color palette");this.colorPalette=e,this.table=void 0}isValid(){return void 0!==this.table}getMinimumOutputValue(){return Number.MIN_SAFE_INTEGER}getMaximumOutputValue(){return Number.MAX_SAFE_INTEGER}recalculate(){if(!this.isValid()){this.table=new Array(256);for(let e=0;e<256;e++)this.table[e]=this.colorPalette[e]}}getValue(e){return Math.trunc(this.table[e])}}class d extends o{constructor(){super(),this.luts=[]}addLut(e){if(!(e instanceof o))throw new Error(`${e.toString()} is not a LUT`);this.luts.push(e)}isValid(){for(let e=0;e<this.luts.length;e++){if(!this.luts[e].isValid())return!1}return!0}getMinimumOutputValue(){let e;return this.luts.length>0&&(e=this.luts[this.luts.length-1]),void 0!==e?e.getMinimumOutputValue():0}getMaximumOutputValue(){let e;return this.luts.length>0&&(e=this.luts[this.luts.length-1]),void 0!==e?e.getMaximumOutputValue():255}recalculate(){for(let e=0;e<this.luts.length;e++){this.luts[e].recalculate()}}getValue(e){for(let t=0;t<this.luts.length;t++){e=this.luts[t].getValue(e)}return Math.trunc(e)}}class p extends o{constructor(e,t,i){super(),this.minValue=t,this.maxValue=i,this.offset=-this.minValue,this.table=new Array(this.maxValue-this.minValue+1),this.lut=e}isValid(){return this.lut.isValid()}getMinimumOutputValue(){return this.lut.getMinimumOutputValue()}getMaximumOutputValue(){return this.lut.getMaximumOutputValue()}recalculate(){this.isValid()||this.lut.recalculate();for(let e=this.minValue;e<=this.maxValue;e++)this.table[e+this.offset]=this.lut.getValue(e)}getValue(e){const t=e+this.offset;return t<0?this.table[0]:t>=this.table.length?this.table[this.table.length-1]:Math.trunc(this.table[t])}}class m extends o{constructor(e,t,i){super(),this.minValue=t,this.maxValue=i,this.offset=-this.minValue,this.lutCache={},this.lutCacheLength=this.maxValue-this.minValue+1,this.lut=e}isValid(){return this.lut.isValid()}getMinimumOutputValue(){return this.lut.getMinimumOutputValue()}getMaximumOutputValue(){return this.lut.getMaximumOutputValue()}recalculate(){this.isValid()||this.lut.recalculate()}getValue(e){const t=e+this.offset;return t<0?this._getOrCalculate(0):t>=this.lutCacheLength?this._getOrCalculate(this.lutCacheLength-1):this._getOrCalculate(t)}_getOrCalculate(e){if(void 0!==this.lutCache[e])return this.lutCache[e];const t=this.lut.getValue(e-this.offset);return this.lutCache[e]=Math.trunc(t),t}}class f{getLut(){throw new Error("getLut should be implemented")}static create(e,t,i,a){const o=e.getPhotometricInterpretation();if(o===r.Monochrome1||o===r.Monochrome2){const l=new w(e.getRescaleSlope(),e.getRescaleIntercept(),e.getBitsStored(),e.isSigned());return l.setColorPalette(void 0!==a&&a!==s.Grayscale?n.getColorPaletteStandard(a):o===r.Monochrome1?n.getColorPaletteMonochrome1():n.getColorPaletteMonochrome2()),l.setWindowLevel(t||this._calculateWindowLevel(e,i)),l.setVoiLutFunction(e.getVoiLutFunction()),l}if(o===r.Rgb||o===r.YbrFull||o===r.YbrFull422||o===r.YbrPartial422||o===r.YbrIct||o===r.YbrRct||o===r.Argb||o===r.Cmyk||o===r.Hsv)return new x;if(o===r.PaletteColor)return new P(e);throw new Error(`Unsupported LUT pipeline photometric interpretation: ${o}`)}static _calculateWindowLevel(e,t){if(void 0!==e.getSmallestImagePixelValue()&&void 0!==e.getLargestImagePixelValue()){const t=e.getSmallestImagePixelValue(),i=e.getLargestImagePixelValue();if(t<i)return new a(Math.abs(i-t),(i+t)/2,"Smallest-largest value window")}let i;if(1===e.getBitsStored())return new a(2,1,"Single-bit window");if(e.getBitsStored()<=8)i=e.getFrameDataU8(t);else if(e.getBitsStored()<=16)i=e.isSigned()?e.getFrameDataS16(t):e.getFrameDataU16(t);else{if(!(e.getBitsStored()<=32))throw new Error(`Unsupported pixel data value for bits stored: ${e.getBitsStored()}`);i=e.hasFloatPixelData()?e.getFrameDataF32(t):e.isSigned()?e.getFrameDataS32(t):e.getFrameDataU32(t)}let r=i[0],s=i[0];const n=e.getPixelPaddingValue();for(let e=0;e<i.length;e++){const t=i[e];void 0!==n&&n===t||(t>s&&(s=t),t<r&&(r=t))}return r=r<e.getMinimumPixelValue()?e.getMinimumPixelValue():r,s=s>e.getMaximumPixelValue()?e.getMaximumPixelValue():s,r=Math.trunc(r*e.getRescaleSlope()+e.getRescaleIntercept()),s=Math.trunc(s*e.getRescaleSlope()+e.getRescaleIntercept()),new a(Math.max(1,Math.abs(s-r)),(s+r)/2,"Min-max value window")}}class w extends f{constructor(e,t,i,r){super(),this.bitsStored=i,this.minValue=r?-Math.pow(2,i-1):0,this.maxValue=r?Math.pow(2,i-1)-1:Math.pow(2,i)-1,this.rescaleLut=new l(this.minValue,this.maxValue,e,t),this.voiLut=new h(new a(this.maxValue-this.minValue,(this.minValue+this.maxValue)/2),"LINEAR"),this.outputLut=new g(n.getColorPaletteMonochrome2()),this.invert=!1,this.lut=void 0,this.precalculatedOrCachedLut=void 0}getWindowLevel(){return this.voiLut.getWindowLevel()}setWindowLevel(e){this.voiLut.setWindowLevel(e)}getVoiLutFunction(){return this.voiLut.getFunction()}setVoiLutFunction(e){this.voiLut.setFunction(e)}getColorPalette(){return this.outputLut.getColorPalette()}setColorPalette(e){this.outputLut.setColorPalette(e)}getInvert(){return this.invert}setInvert(e){this.invert=e,this.lut=void 0}getLut(){if(!this.lut){const e=new d;void 0!==this.rescaleLut&&e.addLut(this.rescaleLut),e.addLut(this.voiLut),e.addLut(this.outputLut),this.invert&&e.addLut(new u(this.outputLut.getMinimumOutputValue(),this.outputLut.getMaximumOutputValue())),this.lut=e}return this.precalculatedOrCachedLut||(this.precalculatedOrCachedLut=32===this.bitsStored?new m(this.lut,this.minValue,this.maxValue):new p(this.lut,this.minValue,this.maxValue)),this.precalculatedOrCachedLut}}class x extends f{constructor(){super()}getLut(){}}class P extends f{constructor(e){super();const t=n.getColorPalettePaletteColor(e);let i=0;const r=e.getRedPaletteColorLookupTableDescriptor();void 0!==r&&Array.isArray(r)&&r.length>0&&(i=r[1]),this.lut=new c(i,t)}getLut(){return this.lut}}e.exports={CachedLut:m,CompositeLut:d,GrayscaleLutPipeline:w,InvertLut:u,Lut:o,LutPipeline:f,OutputLut:g,PaletteColorLut:c,PaletteColorLutPipeline:P,PreCalculatedLut:p,RescaleLut:l,RgbColorLutPipeline:x,VoiLut:h}},590:(module,__unused_webpack_exports,__webpack_require__)=>{const{PhotometricInterpretation}=__webpack_require__(492),log=__webpack_require__(547),wasmFilename="native-pixel-decoder.wasm";Object.freeze(wasmFilename);const ErrNo={Success:0,BadFileDescriptor:8};Object.freeze(ErrNo);class NativePixelDecoder{static async initializeAsync(e){e=e||{},this.logNativeDecodersMessages=e.logNativeDecodersMessages||!1,this.webAssemblyModulePathOrUrl=e.webAssemblyModulePathOrUrl;const t=await this._createWebAssemblyInstance();this.wasmApi={wasmInstance:t,wasmMemory:t.exports.memory,wasmEnv:{},createDecoderContext:t.exports.CreateDecoderContext,releaseDecoderContext:t.exports.ReleaseDecoderContext,getColumns:t.exports.GetColumns,setColumns:t.exports.SetColumns,getRows:t.exports.GetRows,setRows:t.exports.SetRows,getBitsAllocated:t.exports.GetBitsAllocated,setBitsAllocated:t.exports.SetBitsAllocated,getBitsStored:t.exports.GetBitsStored,setBitsStored:t.exports.SetBitsStored,getSamplesPerPixel:t.exports.GetSamplesPerPixel,setSamplesPerPixel:t.exports.SetSamplesPerPixel,getPixelRepresentation:t.exports.GetPixelRepresentation,setPixelRepresentation:t.exports.SetPixelRepresentation,getPlanarConfiguration:t.exports.GetPlanarConfiguration,setPlanarConfiguration:t.exports.SetPlanarConfiguration,getPhotometricInterpretation:t.exports.GetPhotometricInterpretation,setPhotometricInterpretation:t.exports.SetPhotometricInterpretation,getEncodedBuffer:t.exports.GetEncodedBuffer,getEncodedBufferSize:t.exports.GetEncodedBufferSize,setEncodedBuffer:t.exports.SetEncodedBuffer,setEncodedBufferSize:t.exports.SetEncodedBufferSize,getDecodedBuffer:t.exports.GetDecodedBuffer,getDecodedBufferSize:t.exports.GetDecodedBufferSize,setDecodedBuffer:t.exports.SetDecodedBuffer,setDecodedBufferSize:t.exports.SetDecodedBufferSize,createDecoderParameters:t.exports.CreateDecoderParameters,releaseDecoderParameters:t.exports.ReleaseDecoderParameters,getConvertColorspaceToRgb:t.exports.GetConvertColorspaceToRgb,setConvertColorspaceToRgb:t.exports.SetConvertColorspaceToRgb,decodeRleFn:t.exports.DecodeRle,decodeJpegFn:t.exports.DecodeJpeg,decodeJpegLsFn:t.exports.DecodeJpegLs,decodeJpeg2000Fn:t.exports.DecodeJpeg2000}}static decodeRle(e,t,i){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const r=this._createDecoderContext(e,t),s=this._createDecoderParameters(i);return this.wasmApi.decodeRleFn(r,s),this._releaseDecoderParameters(s),this._releaseDecoderContext(r)}static decodeJpeg(e,t,i){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const r=this._createDecoderContext(e,t),s=this._createDecoderParameters(i);return this.wasmApi.decodeJpegFn(r,s),this._releaseDecoderParameters(s),this._releaseDecoderContext(r)}static decodeJpegLs(e,t,i){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const r=this._createDecoderContext(e,t),s=this._createDecoderParameters(i);return this.wasmApi.decodeJpegLsFn(r,s),this._releaseDecoderParameters(s),this._releaseDecoderContext(r)}static decodeJpeg2000(e,t,i){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const r=this._createDecoderContext(e,t),s=this._createDecoderParameters(i);return this.wasmApi.decodeJpeg2000Fn(r,s),this._releaseDecoderParameters(s),this._releaseDecoderContext(r)}static _createDecoderContext(e,t){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const i=this.wasmApi.createDecoderContext();this.wasmApi.setColumns(i,e.getWidth()),this.wasmApi.setRows(i,e.getHeight()),this.wasmApi.setBitsAllocated(i,e.getBitsAllocated()),this.wasmApi.setBitsStored(i,e.getBitsStored()),this.wasmApi.setSamplesPerPixel(i,e.getSamplesPerPixel()),this.wasmApi.setPixelRepresentation(i,e.getPixelRepresentation()),this.wasmApi.setPlanarConfiguration(i,e.getPlanarConfiguration()),this.wasmApi.setPhotometricInterpretation(i,Object.keys(PhotometricInterpretation).indexOf(e.getPhotometricInterpretation())),this.wasmApi.setEncodedBufferSize(i,t.length);const r=this.wasmApi.getEncodedBuffer(i);return new Uint8Array(this.wasmApi.wasmMemory.buffer).set(t,r),i}static _releaseDecoderContext(e){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const t=this.wasmApi.getDecodedBuffer(e),i=this.wasmApi.getDecodedBufferSize(e),r=new Uint8Array(this.wasmApi.wasmMemory.buffer),s=new Uint8Array(r.buffer,t,i).slice(0);return this.wasmApi.releaseDecoderContext(e),s}static _createDecoderParameters(e){if(e=e||{},!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const t=this.wasmApi.createDecoderParameters();return this.wasmApi.setConvertColorspaceToRgb(t,e.convertColorspaceToRgb||!1),t}static _releaseDecoderParameters(e){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");this.wasmApi.releaseDecoderParameters(e)}static async _createWebAssemblyInstance(){const e={wasi_snapshot_preview1:{environ_get:(e,t)=>{if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const i=new Uint8Array(this.wasmApi.wasmMemory.buffer),r=new DataView(this.wasmApi.wasmMemory.buffer),s=this.wasmApi.wasmEnv;return Object.keys(s).forEach((n=>{r.setUint32(e,t,!0),e+=4;const a=this._stringToBytes(`${n}=${s[n]}\0`);i.set(a,t),t+=a.length})),ErrNo.Success},environ_sizes_get:(e,t)=>{if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const i=new DataView(this.wasmApi.wasmMemory.buffer),r=this.wasmApi.wasmEnv;return i.setUint32(e,Object.keys(r).length,!0),i.setUint32(t,Object.keys(r).reduce(((e,t)=>e+this._stringToBytes(`${t}=${r[t]}\0`).length),0),!0),ErrNo.Success},proc_exit:e=>{throw new Error(`WebAssembly module exited with return value ${e}`)},fd_write:(e,t,i,r)=>{if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");if(1!==e&&2!==e)return ErrNo.BadFileDescriptor;const s=new DataView(this.wasmApi.wasmMemory.buffer);let n=0;for(let e=0;e<i;e++){const e=s.getUint32(t,!0);t+=4;const i=s.getUint32(t,!0);t+=4;const r=this._wasmToJsString(e,i);log.error(`NativePixelDecoder::fd_write::${r}`),n+=i}return s.setUint32(r,n,!0),ErrNo.Success},fd_seek:(e,t,i,r)=>ErrNo.Success,fd_close:e=>ErrNo.Success},env:{emscripten_notify_memory_growth:e=>{},onNativePixelDecoderMessage:(e,t)=>{if(!this.logNativeDecodersMessages)return;const i=this._wasmToJsString(e,t);log.info(`NativePixelDecoder::onNativePixelDecoderMessage::${i}`)},onNativePixelDecoderException:(e,t)=>{const i=this._wasmToJsString(e,t);throw new Error(i)}}},t=await this._getWebAssemblyBytes(),{instance:i}=await WebAssembly.instantiate(t,e);return i}static async _getWebAssemblyBytes(){const isNodeJs=!("undefined"==typeof process||!process.versions||!process.versions.node);if(!isNodeJs){const response=await eval("fetch(this.webAssemblyModulePathOrUrl || wasmFilename)"),responseArrayBuffer=await response.arrayBuffer();return responseArrayBuffer}const fs=eval("require('fs')"),path=eval("require('path')"),buffer=await fs.promises.readFile(this.webAssemblyModulePathOrUrl||path.resolve(__dirname,wasmFilename));return buffer.buffer.slice(buffer.byteOffset,buffer.byteOffset+buffer.byteLength)}static _wasmToJsString(e,t){if(!this.wasmApi)throw new Error("NativePixelDecoder module is not initialized");const i=new Uint8Array(this.wasmApi.wasmMemory.buffer),r=new Uint8Array(i.buffer,e,t);let s="";for(let e=0;e<t;e++)s+=String.fromCharCode(r[e]);return s}static _stringToBytes(e){return e.split("").map((e=>e.charCodeAt(0)))}}module.exports=NativePixelDecoder},153:(e,t,i)=>{const{SingleBitPixelPipeline:r}=i(605),s=i(736),n=i(547),a=i(111),{Tag:o}=a.data;class l{render(e,t,i,r){throw new Error("render should be implemented")}static fromDicomImageElements(e){const t=[],i=Object.keys(e);for(let r=0;r<i.length;r++){const s=i[r],n=o.fromString(s);16===n.element()&&n.group()>=24576&&n.group()<=24831&&n.group()%2==0&&t.push(new h(e,n.group()))}const r=e.GraphicAnnotationSequence;return void 0!==r&&Array.isArray(r)&&r.length>0&&r.forEach((e=>{const i=e.GraphicObjectSequence;void 0!==i&&Array.isArray(i)&&i.length>0&&i.forEach((e=>{t.push(new u(e))}))})),t}}class h extends l{constructor(e,t){super(),this.group=t,this.height=this._getElement(e,o.fromNumbers(t,16).toCleanString())||0,this.width=this._getElement(e,o.fromNumbers(t,17).toCleanString())||0,this.type=this._getElement(e,o.fromNumbers(t,64).toCleanString())||"Unknown",this.originX=0,this.originY=0;const i=this._getElement(e,o.fromNumbers(t,80).toCleanString());void 0!==i&&Array.isArray(i)&&2===i.length&&(this.originX=i[0],this.originY=i[1]),this.bitsAllocated=this._getElement(e,o.fromNumbers(t,256).toCleanString())||1,this.bitPosition=this._getElement(e,o.fromNumbers(t,258).toCleanString())||0,this.description=this._getElement(e,o.fromNumbers(t,34).toCleanString())||"",this.subtype=this._getElement(e,o.fromNumbers(t,69).toCleanString())||"",this.label=this._getElement(e,o.fromNumbers(t,5376).toCleanString())||"",this.frames=this._getElement(e,o.fromNumbers(t,21).toCleanString())||1,this.frameOrigin=this._getElement(e,o.fromNumbers(t,81).toCleanString())||1,this.data=this._getElement(e,o.fromNumbers(t,12288).toCleanString())}getGroup(){return this.group}getWidth(){return this.width}getHeight(){return this.height}getType(){return this.type}getOriginX(){return this.originX}getOriginY(){return this.originY}getBitsAllocated(){return this.bitsAllocated}getBitPosition(){return this.bitPosition}getDescription(){return this.description}getSubtype(){return this.subtype}getLabel(){return this.label}getNumberOfFrames(){return this.frames}getFrameOrigin(){return this.frameOrigin}getData(){return this.data}render(e,t,i,s){if(!this.getData())return void n.warn("G60xx overlay: No data. Skipping...");if(!this.getWidth()||!this.getHeight())return void n.warn("G60xx overlay: No width or height. Skipping...");if(!this.getBitsAllocated())return void n.warn("G60xx overlay: No bits allocated. Skipping...");const a=this.getData();let o=new Uint8Array(Array.isArray(a)?a.find((e=>e)):a);const l=new r(this.getWidth(),this.getHeight(),o).render(),h=this.getOriginX()-1,u=this.getOriginY()-1,c=this.getHeight(),g=this.getWidth();for(let r=0;r<c;++r){if(u+r>=i)return;for(let i=g*r,n=i+g,a=(u+r)*t+h,o=0;i<n;i++,a++,o++)if(l[i]>0){if(h+o>=t)break;e[a]|=s}}}_getElement(e,t){return e[t]}}class u extends l{constructor(e){super(),this.graphicAnnotationUnits=e.GraphicAnnotationUnits,this.graphicDimensions=e.GraphicDimensions,this.numberOfGraphicPoints=e.NumberOfGraphicPoints,this.graphicData=e.GraphicData,this.graphicType=e.GraphicType,this.graphicFilled=e.GraphicFilled}getGraphicAnnotationUnits(){return this.graphicAnnotationUnits}getGraphicDimensions(){return this.graphicDimensions}getNumberOfGraphicPoints(){return this.numberOfGraphicPoints}getGraphicData(){return this.graphicData}getGraphicType(){return this.graphicType}getGraphicFilled(){return this.graphicFilled}render(e,t,i,r){const a=this.getGraphicData();if(!a||!Array.isArray(a))return void n.warn("GSPS graphic overlay: No graphic data. Skipping...");if(!this.getGraphicType())return void n.warn("GSPS graphic overlay: No graphic type. Skipping...");if("PIXEL"!==this.getGraphicAnnotationUnits()&&"DISPLAY"!==this.getGraphicAnnotationUnits())return void n.warn(`GSPS graphic overlay: ${this.getGraphicAnnotationUnits()} graphic annotation units is not supported. Skipping...`);const o=this.getGraphicFilled();o&&"Y"===o&&n.warn("GSPS graphic overlay: Filled graphics are not supported. Will render just the basic shape...");const l="DISPLAY"===this.getGraphicAnnotationUnits();switch(this.getGraphicType()){case"POINT":{if(2!==a.length)return void n.warn(`GSPS graphic overlay: POINT graphic type should contain 2 graphic data values [Got: ${a.length}]. Skipping...`);const o=[l?a[0]*t:a[0],l?a[1]*i:a[1],l?a[0]*t:a[0],l?a[1]*i:a[1]];s.drawPolyline(e,t,i,o,r)}break;case"POLYLINE":{const n=[];for(let e=0;e<a.length/2;e++)n.push(l?a[2*e]*t:a[2*e],l?a[2*e+1]*i:a[2*e+1]);s.drawPolyline(e,t,i,n,r)}break;default:n.warn(`GSPS graphic overlay: ${this.getGraphicType()} graphic type is not supported yet. Skipping...`)}}}e.exports={G60xxOverlay:h,GspsGraphicOverlay:u,Overlay:l}},605:(e,t,i)=>{const{PhotometricInterpretation:r,PixelRepresentation:s,PlanarConfiguration:n,TransferSyntax:a}=i(492),o=i(675),l=i(590),h=i(547);class u{getWidth(){throw new Error("getWidth should be implemented")}getHeight(){throw new Error("getHeight should be implemented")}getMinimumPixelValue(){throw new Error("getMinimumPixelValue should be implemented")}getMaximumPixelValue(){throw new Error("getMaximumPixelValue should be implemented")}getComponents(){throw new Error("getComponents should be implemented")}render(e){throw new Error("render should be implemented")}calculateHistograms(){throw new Error("calculateHistograms should be implemented")}static create(e,t){this._applyPipelineFixes(e);let i=e.getPhotometricInterpretation();if(i===r.Monochrome1||i===r.Monochrome2||i===r.PaletteColor){if(1===e.getBitsStored())return new g(e.getWidth(),e.getHeight(),e.getFrameDataU8(t));if(8===e.getBitsAllocated()&&7===e.getHighBit()&&8===e.getBitsStored())return new c(e.getWidth(),e.getHeight(),e.getMinimumPixelValue(),e.getMaximumPixelValue(),e.getFrameDataU8(t));if(e.getBitsAllocated()<=16)return new c(e.getWidth(),e.getHeight(),e.getMinimumPixelValue(),e.getMaximumPixelValue(),e.isSigned()?e.getFrameDataS16(t):e.getFrameDataU16(t));if(e.getBitsAllocated()<=32)return new c(e.getWidth(),e.getHeight(),e.getMinimumPixelValue(),e.getMaximumPixelValue(),e.hasFloatPixelData()?e.getFrameDataF32(t):e.isSigned()?e.getFrameDataS32(t):e.getFrameDataU32(t));throw new Error(`Unsupported pixel data value for bits stored: ${e.getBitsStored()}`)}if(i===r.Rgb||i===r.YbrFull||i===r.YbrFull422||i===r.YbrPartial422||i===r.Cmyk||i===r.Argb||i===r.Hsv){let s=e.getFrameDataU8(t);if(e.getPlanarConfiguration()===n.Planar&&(s=p.planarToInterleaved24(s)),i===r.YbrFull)s=p.ybrFullToRgb(s);else if(i===r.YbrFull422)s=p.ybrFull422ToRgb(s,e.getWidth());else if(i===r.YbrPartial422)s=p.ybrPartial422ToRgb(s,e.getWidth());else if(i===r.Cmyk){if(4!==e.getSamplesPerPixel())throw new Error(`Unsupported samples per pixel value for CMYK: ${e.getSamplesPerPixel()}`);s=p.cmykToRgb(s,e.getWidth(),e.getHeight())}else if(i===r.Argb){if(4!==e.getSamplesPerPixel())throw new Error(`Unsupported samples per pixel value for ARGB: ${e.getSamplesPerPixel()}`);s=p.argbToRgb(s,e.getWidth(),e.getHeight())}else i===r.Hsv&&(s=p.hsvToRgb(s));return new d(e.getWidth(),e.getHeight(),e.getMinimumPixelValue(),e.getMaximumPixelValue(),s)}throw new Error(`Unsupported pixel data photometric interpretation: ${i}`)}static _applyPipelineFixes(e){e.getTransferSyntaxUid()!==a.JpegBaselineProcess1&&e.getTransferSyntaxUid()!==a.JpegBaselineProcess2_4||3!==e.getSamplesPerPixel()||(e.photometricInterpretation=r.Rgb,e.planarConfiguration=n.Interleaved),e.getTransferSyntaxUid()!==a.Jpeg2000Lossless&&e.getTransferSyntaxUid()!==a.Jpeg2000Lossy&&e.getTransferSyntaxUid()!==a.HtJpeg2000Lossless&&e.getTransferSyntaxUid()!==a.HtJpeg2000LosslessRpcl&&e.getTransferSyntaxUid()!==a.HtJpeg2000Lossy||e.getPhotometricInterpretation()!==r.YbrRct&&e.getPhotometricInterpretation()!==r.YbrIct||(e.photometricInterpretation=r.Rgb)}}class c extends u{constructor(e,t,i,r,s){super(),this.width=e,this.height=t,this.minValue=i,this.maxValue=r,this.data=s}getWidth(){return this.width}getHeight(){return this.height}getMinimumPixelValue(){return this.minValue}getMaximumPixelValue(){return this.maxValue}getComponents(){return 1}render(e){const t=new Int32Array(this.getWidth()*this.getHeight());if(e)for(let i=0;i<this.getHeight();++i)for(let r=this.getWidth()*i,s=r+this.getWidth();r<s;r++)t[r]=e.getValue(this.data[r]);else for(let e=0;e<this.getHeight();++e)for(let i=this.getWidth()*e,r=i+this.getWidth();i<r;i++)t[i]=this.data[i];return t}calculateHistograms(){const e=new o("gray",this.minValue,this.maxValue);for(let t=0;t<this.data.length;t++)e.add(this.data[t]);return[e]}}class g extends c{constructor(e,t,i){super(e,t,0,1,g._expandBits(e,t,i))}static _expandBits(e,t,i){const r=new Uint8Array(e*t);for(let s=0,n=e*t;s<n;s++){const e=Math.floor(s/8),t=s-8*e,n=i[e];if(n<0||n>255)throw new Error("Array item must be in 0-255 range");const a=n>>>t&1;r[s]=a?1:0}return r}calculateHistograms(){const e=new o("bit",this.minValue,this.maxValue);for(let t=0;t<this.data.length;t++)e.add(this.data[t]);return[e]}}class d extends u{constructor(e,t,i,r,s){super(),this.width=e,this.height=t,this.minValue=i,this.maxValue=r,this.data=s}getWidth(){return this.width}getHeight(){return this.height}getMinimumPixelValue(){return this.minValue}getMaximumPixelValue(){return this.maxValue}getComponents(){return 3}render(e){const t=new Int32Array(this.getWidth()*this.getHeight());if(e)for(let i=0;i<this.getHeight();++i)for(let r=this.getWidth()*i,s=r+this.getWidth(),n=3*r;r<s;r++)t[r]=e.getValue(this.data[n++]<<16)|e.getValue(this.data[n++]<<8)|e.getValue(this.data[n++]);else for(let e=0;e<this.getHeight();++e)for(let i=this.getWidth()*e,r=i+this.getWidth(),s=3*i;i<r;i++)t[i]=this.data[s++]<<16|this.data[s++]<<8|this.data[s++];return t}calculateHistograms(){const e=new o("red",this.minValue,this.maxValue),t=new o("green",this.minValue,this.maxValue),i=new o("blue",this.minValue,this.maxValue);for(let r=0;r<this.data.length;r+=3)e.add(this.data[r]),t.add(this.data[r+1]),i.add(this.data[r+2]);return[e,t,i]}}class p{static planarToInterleaved24(e){const t=new Uint8Array(e.length),i=Math.trunc(e.length/3);for(let r=0;r<i;r++)t[3*r]=e[r],t[3*r+1]=e[r+1*i],t[3*r+2]=e[r+2*i];return t}static ybrFullToRgb(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i+=3){const r=e[i],s=e[i+1],n=e[i+2];t[i]=this._truncAndClamp(r+1.402*(n-128)+.5,0,255),t[i+1]=this._truncAndClamp(r-.3441*(s-128)-.7141*(n-128)+.5,0,255),t[i+2]=this._truncAndClamp(r+1.772*(s-128)+.5,0,255)}return t}static ybrFull422ToRgb(e,t){const i=new Uint8Array(Math.trunc(e.length/4*2*3));for(let r=0,s=0,n=0;r<e.length;){const a=e[r++],o=e[r++],l=e[r++],h=e[r++];i[s++]=this._truncAndClamp(a+1.402*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(a-.3441*(l-128)-.7141*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(a+1.772*(l-128)+.5,0,255),++n!==t?(i[s++]=this._truncAndClamp(o+1.402*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(o-.3441*(l-128)-.7141*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(o+1.772*(l-128)+.5,0,255),++n===t&&(n=0)):n=0}return i}static ybrPartial422ToRgb(e,t){const i=new Uint8Array(Math.trunc(e.length/4*2*3));for(let r=0,s=0,n=0;r<e.length;){const a=e[r++],o=e[r++],l=e[r++],h=e[r++];i[s++]=this._truncAndClamp(1.1644*(a-16)+1.596*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(1.1644*(a-16)-.3917*(l-128)-.813*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(1.1644*(a-16)+2.0173*(l-128)+.5,0,255),++n!==t?(i[s++]=this._truncAndClamp(1.1644*(o-16)+1.596*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(1.1644*(o-16)-.3917*(l-128)-.813*(h-128)+.5,0,255),i[s++]=this._truncAndClamp(1.1644*(o-16)+2.0173*(l-128)+.5,0,255),++n===t&&(n=0)):n=0}return i}static cmykToRgb(e,t,i){const r=new Uint8Array(3*t*i);for(let t=0,i=0;t<e.length;){let s=e[t++],n=e[t++],a=e[t++];const o=e[t++];s+=o,n+=o,a+=o,r[i++]=this._truncAndClamp(255-s,0,255),r[i++]=this._truncAndClamp(255-n,0,255),r[i++]=this._truncAndClamp(255-a,0,255)}return r}static argbToRgb(e,t,i){const r=new Uint8Array(3*t*i);for(let t=0,i=0;t<e.length;)t++,r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++];return r}static hsvToRgb(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i+=3){const r=e[i],s=e[i+1],n=e[i+2];let a=n,o=n,l=n;if(0!==s){const e=Math.trunc(r/43),t=6*(r-43*e),i=n*(255-s)>>8,h=n*(255-(s*t>>8))>>8,u=n*(255-(s*(255-t)>>8))>>8;0===e?(a=n,o=u,l=i):1===e?(a=h,o=n,l=i):2===e?(a=i,o=n,l=u):3===e?(a=i,o=h,l=n):4===e?(a=u,o=i,l=n):(a=n,o=i,l=h)}t[i]=this._truncAndClamp(a,0,255),t[i+1]=this._truncAndClamp(o,0,255),t[i+2]=this._truncAndClamp(l,0,255)}return t}static _truncAndClamp(e,t,i){return Math.min(Math.max(Math.trunc(e),t),i)}}e.exports={ColorPixelPipeline:d,GrayscalePixelPipeline:c,Pixel:class{constructor(e,t){this.transferSyntaxUid=t,this.frames=this._getElement(e,"NumberOfFrames")||1,this.width=this._getElement(e,"Columns"),this.height=this._getElement(e,"Rows"),this.bitsAllocated=this._getElement(e,"BitsAllocated")||0,this.bitsStored=this._getElement(e,"BitsStored")||this.bitsAllocated,this.highBit=this._getElement(e,"HighBit")||this.bitsStored-1,this.samplesPerPixel=this._getElement(e,"SamplesPerPixel")||1,this.pixelRepresentation=this._getElement(e,"PixelRepresentation")||s.Unsigned,this.planarConfiguration=this._getElement(e,"PlanarConfiguration")||n.Interleaved;const i=this._getElement(e,"PhotometricInterpretation");this.photometricInterpretation=i?i.replace(/[^ -~]+/g,"").trim():"",this.rescaleSlope=this._getElement(e,"RescaleSlope")||1,this.rescaleIntercept=this._getElement(e,"RescaleIntercept")||0,this.voiLutFunction=this._getElement(e,"VOILUTFunction")||"LINEAR",this.smallestImagePixelValue=this._getElement(e,"SmallestImagePixelValue"),this.largestImagePixelValue=this._getElement(e,"LargestImagePixelValue"),this.pixelPaddingValue=this._getElement(e,"PixelPaddingValue"),this.floatPixelPaddingValue=this._getElement(e,"FloatPixelPaddingValue"),this.redPaletteColorLookupTableDescriptor=this._getElement(e,"RedPaletteColorLookupTableDescriptor"),this.redPaletteColorLookupTableData=this._getElement(e,"RedPaletteColorLookupTableData"),this.greenPaletteColorLookupTableData=this._getElement(e,"GreenPaletteColorLookupTableData"),this.bluePaletteColorLookupTableData=this._getElement(e,"BluePaletteColorLookupTableData"),this.pixelData=this._getElement(e,"PixelData"),this.floatPixelData=this._getElement(e,"FloatPixelData"),this._applyPixelFixes()}getTransferSyntaxUid(){return this.transferSyntaxUid}getNumberOfFrames(){return this.frames}getWidth(){return this.width}getHeight(){return this.height}getBitsStored(){return this.bitsStored}getBitsAllocated(){return this.bitsAllocated}getBytesAllocated(){let e=this.getBitsAllocated()/8;return this.getBitsAllocated()%8>0&&e++,e}getHighBit(){return this.highBit}getSamplesPerPixel(){return this.samplesPerPixel}getPixelRepresentation(){return this.pixelRepresentation}isSigned(){return this.getPixelRepresentation()!==s.Unsigned}getMinimumPixelValue(){return this.isSigned()?-Math.pow(2,this.getBitsStored()-1):0}getMaximumPixelValue(){return this.isSigned()?Math.pow(2,this.getBitsStored()-1)-1:Math.pow(2,this.getBitsStored())-1}getPlanarConfiguration(){return this.planarConfiguration}isPlanar(){return 0!==this.getPlanarConfiguration()}getPhotometricInterpretation(){return this.photometricInterpretation}getUncompressedFrameSize(){if(1===this.getBitsAllocated())return Math.trunc((this.getWidth()*this.getHeight()-1)/8+1);if(this.getPhotometricInterpretation()===r.YbrFull422){const e=this.getTransferSyntaxUid();if(e===a.ImplicitVRLittleEndian||e===a.ExplicitVRLittleEndian||e===a.DeflatedExplicitVRLittleEndian||e===a.ExplicitVRBigEndian)return 2*this.getBytesAllocated()*this.getWidth()*this.getHeight()}return this.getWidth()*this.getHeight()*this.getBytesAllocated()*this.getSamplesPerPixel()}getRescaleSlope(){return this.rescaleSlope}getRescaleIntercept(){return this.rescaleIntercept}getVoiLutFunction(){return this.voiLutFunction}getSmallestImagePixelValue(){return this.smallestImagePixelValue}getLargestImagePixelValue(){return this.largestImagePixelValue}getPixelPaddingValue(){return this.pixelPaddingValue||this.floatPixelPaddingValue}getRedPaletteColorLookupTableDescriptor(){return this.redPaletteColorLookupTableDescriptor}getRedPaletteColorLookupTableData(){return this.redPaletteColorLookupTableData}getGreenPaletteColorLookupTableData(){return this.greenPaletteColorLookupTableData}getBluePaletteColorLookupTableData(){return this.bluePaletteColorLookupTableData}getPixelData(){return this.pixelData||this.floatPixelData}hasFloatPixelData(){return void 0!==this.floatPixelData}getFrameDataU8(e){return this._getFrameBuffer(e)}getFrameDataU16(e){const t=this._getFrameBuffer(e);return new Uint16Array(t.buffer,t.byteOffset,t.byteLength/Uint16Array.BYTES_PER_ELEMENT)}getFrameDataS16(e){const t=this.getFrameDataU16(e),i=new Int16Array(t);if(16!==this.getBitsStored()){const e=this.getBitsAllocated()-this.getHighBit()-1,t=this.getBitsAllocated()-this.getBitsStored();for(let r=0;r<i.length;r++)i[r]<<=e,i[r]>>=t}return i}getFrameDataU32(e){const t=this._getFrameBuffer(e);return new Uint32Array(t.buffer,t.byteOffset,t.byteLength/Uint32Array.BYTES_PER_ELEMENT)}getFrameDataS32(e){const t=this.getFrameDataU32(e);return new Int32Array(t)}getFrameDataF32(e){const t=this._getFrameBuffer(e);return new Float32Array(t.buffer,t.byteOffset,t.byteLength/Float32Array.BYTES_PER_ELEMENT)}toString(){const e=[];return e.push(`Pixel Data: ${this.getTransferSyntaxUid()}`),e.push(`    Photometric Interpretation: ${this.getPhotometricInterpretation()}`),e.push(`    Bits Allocated: ${this.getBitsAllocated()};  Stored: ${this.getBitsStored()};  High: ${this.getHighBit()};  Signed: ${this.isSigned()?"True":"False"}`),e.push(`    Width: ${this.getWidth()};  Height: ${this.getHeight()};  Frames: ${this.getNumberOfFrames()}`),this.getSamplesPerPixel()>1?e.push(`    Samples/Pixel: ${this.getSamplesPerPixel()};  Planar: ${this.isPlanar()?"True":"False"}`):e.push(`    Rescale Slope: ${this.getRescaleSlope()};  Intercept: ${this.getRescaleIntercept()}`),e.join("\n")}_getFrameBuffer(e){if(e<0||e>=this.getNumberOfFrames())throw new Error(`Requested frame is out of range [${e}]`);if(!this.getPixelData())throw new Error("Could not extract pixel data");if(!this.getWidth()||!this.getHeight())throw new Error(`Width/height has an invalid value [w: ${this.getWidth()}, h: ${this.getHeight()}]`);if(!this.getBitsAllocated()||!this.getBitsStored())throw new Error(`Bits allocated/stored has an invalid value [allocated: ${this.getBitsAllocated()}, stored: ${this.getBitsStored()}]`);if(!this.getPhotometricInterpretation())throw new Error(`Photometric interpretation has an invalid value [${this.getPhotometricInterpretation()}]`);const t=this.getPixelData();if(this.getTransferSyntaxUid()===a.ImplicitVRLittleEndian||this.getTransferSyntaxUid()===a.ExplicitVRLittleEndian||this.getTransferSyntaxUid()===a.DeflatedExplicitVRLittleEndian||this.getTransferSyntaxUid()===a.ExplicitVRBigEndian){const i=this.getUncompressedFrameSize(),r=i*e;const s=new Uint8Array(Array.isArray(t)?t.find((e=>e)):t).slice(r,r+i);if(this.getTransferSyntaxUid()===a.ExplicitVRBigEndian)if(this.getBitsAllocated()>8&&this.getBitsAllocated()<=16)for(let e=0;e<s.length;e+=2){const t=s[e];s[e]=s[e+1],s[e+1]=t}else if(32===this.getBitsAllocated())if(this.hasFloatPixelData())for(let e=0;e<s.length;e+=4){let t=s[e];s[e]=s[e+3],s[e+3]=t,t=s[e+1],s[e+1]=s[e+2],s[e+2]=t}else for(let e=0;e<s.length;e+=4){let t=s[e];s[e]=s[e+1],s[e+1]=t,t=s[e+2],s[e+2]=s[e+3],s[e+3]=t}return s}{const i=this._getFrameFragments(t,e);if(this.getTransferSyntaxUid()===a.RleLossless)return l.decodeRle(this,i);if(this.getTransferSyntaxUid()===a.JpegBaselineProcess1||this.getTransferSyntaxUid()===a.JpegBaselineProcess2_4)return l.decodeJpeg(this,i,{convertColorspaceToRgb:!0});if(this.getTransferSyntaxUid()===a.JpegLosslessProcess14||this.getTransferSyntaxUid()===a.JpegLosslessProcess14V1)return l.decodeJpeg(this,i);if(this.getTransferSyntaxUid()===a.JpegLsLossless||this.getTransferSyntaxUid()===a.JpegLsLossy)return l.decodeJpegLs(this,i);if(this.getTransferSyntaxUid()===a.Jpeg2000Lossless||this.getTransferSyntaxUid()===a.Jpeg2000Lossy)return l.decodeJpeg2000(this,i);if(this.getTransferSyntaxUid()===a.HtJpeg2000Lossless||this.getTransferSyntaxUid()===a.HtJpeg2000LosslessRpcl||this.getTransferSyntaxUid()===a.HtJpeg2000Lossy)return l.decodeJpeg2000(this,i);throw new Error(`Transfer syntax cannot be currently decoded [${this.getTransferSyntaxUid()}]`)}}_getFrameFragments(e,t){if(0===e.length)throw new Error("No fragmented pixel data");if(t>=e.length)throw new Error(`Requested frame is larger or equal to the pixel fragments number [frame: (${t}), fragments: ${e.length}]`);if(1===this.getNumberOfFrames())return new Uint8Array(e.reduce(((e,t,i)=>{if(0===i)return e;const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer})));if(e.length===this.getNumberOfFrames())return new Uint8Array(e[t]);throw new Error("Multiple fragments per frame is not yet implemented")}_applyPixelFixes(){!this.photometricInterpretation&&this.samplesPerPixel&&(this.pixelData||this.floatPixelData)&&(1===this.samplesPerPixel?this.photometricInterpretation=r.Monochrome2:3===this.samplesPerPixel&&(this.transferSyntaxUid===a.ImplicitVRLittleEndian||this.transferSyntaxUid===a.ExplicitVRLittleEndian||this.transferSyntaxUid===a.DeflatedExplicitVRLittleEndian||this.transferSyntaxUid===a.ExplicitVRBigEndian?this.photometricInterpretation=r.Rgb:this.transferSyntaxUid===a.JpegBaselineProcess1||this.transferSyntaxUid===a.JpegBaselineProcess2_4?this.photometricInterpretation=r.YbrFull422:this.transferSyntaxUid===a.JpegLosslessProcess14||this.transferSyntaxUid===a.JpegLosslessProcess14V1||this.transferSyntaxUid===a.JpegLsLossless||this.transferSyntaxUid===a.JpegLsLossy?this.photometricInterpretation=r.YbrFull:this.transferSyntaxUid===a.Jpeg2000Lossless||this.transferSyntaxUid===a.HtJpeg2000Lossless||this.transferSyntaxUid===a.HtJpeg2000LosslessRpcl?this.photometricInterpretation=r.YbrRct:this.transferSyntaxUid!==a.Jpeg2000Lossy&&this.transferSyntaxUid!==a.HtJpeg2000Lossy||(this.photometricInterpretation=r.YbrIct)),h.warn(`Empty photometric interpretation was found and was converted to ${this.photometricInterpretation} because samples per pixel is ${this.samplesPerPixel} and transfer syntax UID is ${this.transferSyntaxUid}`))}_getElement(e,t){return e[t]}},PixelConverter:p,PixelPipeline:u,SingleBitPixelPipeline:g}},736:e=>{e.exports=class{static drawPolyline(e,t,i,r,s){let n=r[0],a=r[1];for(let o=2;o<r.length;o+=2){const l=r[o],h=r[o+1];this._drawLine(e,t,i,n,a,l,h,s),n=l,a=h}}static _drawLine(e,t,i,r,s,n,a,o){const l=t,h=i;let u=n-r,c=a-s;const g=u<0?-1:1;u=u<0?-u:u;const d=c<0?-1:1;c=c<0?-c:c;const p=u>c?g:0,m=u>c?0:d,f=g,w=d,x=u>c?c:u,P=u>c?u:c;let y=r,b=s,v=P>>1;b<h&&b>=0&&y<l&&y>=0&&(e[b*t+y]|=o);for(let i=0;i<P;i++)v-=x,v<0?(v+=P,y+=f,b+=w):(y+=p,b+=m),b<h&&b>=0&&y<l&&y>=0&&(e[b*t+y]|=o)}}},311:e=>{class t{constructor(e,t,i){this.window=e,this.level=t,this.description=i}getWindow(){return this.window}setWindow(e){this.window=e}getLevel(){return this.level}setLevel(e){this.level=e}getDescription(){return this.description}setDescription(e){this.description=e}toString(){return`${this.getWindow()}:${this.getLevel()} ${this.getDescription()||"[No description]"}`}static fromDicomImageElements(e){const i=[];let r=e.WindowCenter,s=e.WindowWidth,n=e.WindowCenterWidthExplanation;if(void 0===r||void 0===s)return i;if(r=Array.isArray(r)?r:[r],s=Array.isArray(s)?s:[s],n=Array.isArray(n)?n:[n],r.length!==s.length)return i;for(let e=0;e<r.length;e++){const a=parseFloat(s[e]),o=parseFloat(r[e]);if(!isNaN(a)&&!isNaN(o)&&a>=1){let r;void 0!==n&&e<n.length&&(r=n[e]),i.push(new t(a,o,r))}}return i}}e.exports=t},237:(e,t,i)=>{const{PhotometricInterpretation:r,PixelRepresentation:s,PlanarConfiguration:n,StandardColorPalette:a,TransferSyntax:o}=i(492),l=i(408),h=i(590),u=i(311),c={constants:{PhotometricInterpretation:r,PixelRepresentation:s,PlanarConfiguration:n,StandardColorPalette:a,TransferSyntax:o},DicomImage:l,Histogram:i(675),log:i(547),NativePixelDecoder:h,version:i(837),WindowLevel:u};e.exports=c},547:(e,t,i)=>{const r=i(213),s=i(935);s.reg(r),r.enableAll(!1),s.apply(r,{format:(e,t,i)=>`${i} -- ${e.toUpperCase()} --`}),e.exports=r},837:e=>{e.exports="0.1.25"},111:e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__111__}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}var __webpack_exports__=__webpack_require__(237);return __webpack_exports__})()));